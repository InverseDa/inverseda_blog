---
title: OpenGL教程：14. 最简单的阴影生成算法——硬阴影生成
date: '2022-11-14 00:00:01'
tags: 
- OpenGL
categories:
- 计算机图形学
toc: false
---

硬阴影是最暴力的一种求阴影的方法，比较逆天，但很简单，原理如下：

![image-20221118221557814](https://cdn.jsdelivr.net/gh/InverseDa/image@master/image/image-20221118221557814.png)

设光位置为$(x_l,y_l,z_l)$，片元位置为$(x,y,z)$，片元的投影位置为$(x_k,y_k,z_k)$。

由几何关系：
$$
\frac{x_l-x}{x-x_k}=\frac{y_l-y}{y-y_k}
$$
解得：
$$
x=\frac{x_l(y-y_k)+x(y_k-y_l)}{y-y_l}
$$
同理解得：
$$
z=\frac{z_l(y-y_k)+z(y_k-y_l)}{y-y_l}
$$
$y_k$是我们设的投影的高度位置，一般设为$y_k=h$，于是可以得到投影矩阵：


<div>
$$
\left[
\begin{array}{cccc}
x_k\\
y_k\\
z_k\\
w_k
\end{array}
\right]
=\left[
\begin{array}{cccc}
y_k-y_l&x_l&0&-x_ly_k\\
0&y_k&0&-y_ly_k\\
0&z_l&y_k-y_l&-z_ly_k\\
0&1&0&-y_l
\end{array}
\right]
\left[
\begin{array}{cccc}
x\\
y\\
z\\
w
\end{array}
\right]
$$
<div>
在着色器中，我们要除以$w_k$分量，保证阴影正确（这是因为矩阵中将分母$y-y_l$处理到$w_k$处了）。

